<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/3/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">



<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
}

.topnav {
  overflow: hidden;
  background-color: #333;
}

@media screen and (min-width: 601px) {
    .topnav a {
      float: left;
      color: #f2f2f2;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
      font-size: 17px;
    }
}

  @media screen and (max-width: 600px) {
    .topnav a {
      float: left;
      color: #f2f2f2;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
      font-size: 13px;

  
    }
  }

.topnav a:hover {
  background-color: #ddd;
  color: black;
}

.topnav a.active {
  background-color: #4CAF50;
  color: white;
}

.topnav-right {
  float: right;
}

table, th {
    table-layout: auto;
    width: 100%;
    border: 1px solid black;
    border-collapse: collapse;
   
    text-align: center;
    border-bottom: 1px solid #ddd;

}
td{
  table-layout: auto;
    border: 1px solid black;
    border-collapse: collapse;
   
    text-align: center;
    border-bottom: 1px solid #ddd;
  width :(100/17)%;
}
tr:hover {background-color: #f5f5f5;}
</style>


<body>
<script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>
<script src="../functions.js"></script>
<script>
  var database;
  initialize();
  getRefs();
  var user = getUser();

</script>
<div class="topnav" id = "navbar">
  <a  href="physicianHome.html" >Home</a>
  <a  class ="active" href="currentClients.html" >Current Clients</a>

  <div class="topnav-right">
    <a href='../index.html' onclick="signOut()" >Logout</a>
  </div>
</div>

<section id=topsection >
    <table id = "Clients" style= "width=100%" >
      
    </table>
	</section>


<script>
  var titles = ["Name", "Email", "Phone Number"];
  var promises = [];
  var table = document.getElementById("Clients");
  var test = localStorage.getItem("user");
  var row = table.insertRow(0);
  var cell = row.insertCell(0);
  cell.innerHTML = test;




 function displayTitles(titles){
    var table = document.getElementById("Clients");
    var titleRow = table.insertRow(0);
    for (var i = 0; i<titles.length; i++){
      var cell = titleRow.insertCell(i);
      cell.innerHTML = titles[i];
    }
    displayClientNames();

  }

  function displayClientNames() {
    firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    var rowIndex = 1;
    var promises = [];

    var table = document.getElementById("Clients");
    database.ref(user.uid+"/clients").once('value', function(snapshot){
      snapshot.forEach(function(childSnapshot){
        var childKey = childSnapshot.key;
        var childValue = childSnapshot.val();
        var row = table.insertRow(rowIndex);
        rowIndex++;
        var cell = row.insertCell(0);
        var emailCell = row.insertCell(1);
        var telCell = row.insertCell(2);
        

        console.log(childKey, childValue);

        promises.push(cell.innerHTML = childKey);
        displayUserInfo(childValue, rowIndex, emailCell, telCell);
        
      });
      return Promise.all(promises);
    });
    }

    });
  }

  function displayUserInfo(uid, row, emailCell, telCell){
    var table = document.getElementById("Clients");
    var row = table.insertRow(row);
    var userRef = database.ref(uid);
    
    userRef.once('value', function(snapshot){
      snapshot.forEach(function(childSnapshot){
        var childKey = childSnapshot.key;
        var childValue = childSnapshot.val();
        switch(childKey){
          case "email": 
            emailCell.innerHTML = childValue;
          break;
          case "tel":
            telCell.innerHTML = childValue;
        }
      });
    });



    

    
  }
</script>


</body>
</html>