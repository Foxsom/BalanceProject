<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/3/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">



<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
}

.topnav {
  overflow: hidden;
  background-color: #333;
}

@media screen and (min-width: 601px) {
    .topnav a {
      float: left;
      color: #f2f2f2;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
      font-size: 17px;
    }
}

  @media screen and (max-width: 600px) {
    .topnav a {
      float: left;
      color: #f2f2f2;
      text-align: center;
      padding: 14px 16px;
      text-decoration: none;
      font-size: 13px;

  
    }
  }

.topnav a:hover {
  background-color: #ddd;
  color: black;
}

.topnav a.active {
  background-color: #4CAF50;
  color: white;
}

.topnav-right {
  float: right;
}


table, th {
    table-layout: auto;
    width: 100%;
    border: 1px solid black;
    border-collapse: collapse;
   
    text-align: center;
    border-bottom: 1px solid #ddd;

}
td{
  table-layout: auto;
    border: 1px solid black;
    border-collapse: collapse;
   
    text-align: center;
    border-bottom: 1px solid #ddd;
  width :(100/17)%;
}
tr:hover {background-color: #f5f5f5;}
</style>


<body>
<script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>
<script src="../functions.js"></script>
<script>
  var database;
  initialize();
  getRefs();
  var user = getUser();

</script>
<div class="topnav" id = "navbar">
  <a  href="physicianHome.html" >Home</a>
  <a  class ="active" href="currentClients.html" >Current Clients</a>

  <div class="topnav-right">
    <a href='../index.html' onclick="signOut()" >Logout</a>
  </div>
</div>

<div class = "form-group">
  <label for="name"><b>Name:</b></label>
  <p id = "name" ></p>

  <label for="email"><b>Email:</b></label>
  <p id = "email"></p>

  <label for="tel"><b>Phone Number:</b></label>
  <p id = "tel"></p>

  <label for="level"><b>Current Level:</b></label>
  <p id = "level"></p>

    <label for="fall"><b>Most Recent Fall Date:</b></label>
  <p id = "fall"></p>
</div>
<label for="levelA"><b>Level A Submissions:</b></label>
    <table id = "levelA" style= "width=100%" >
      
    </table>

<label for="levelB"><b>Level B Submissions:</b></label>
    <table id = "levelB" style= "width=100%" >
      
    </table>

<label for="levelC"><b>Level C Submissions:</b></label>
    <table id = "levelC" style= "width=100%" >
      
    </table>

<label for="levelD"><b>Level D Submissions:</b></label>
    <table id = "levelD" style= "width=100%" >
      
    </table>


<script>
  

  var levelATitles = ["Date", "Knee Extensors", "Knee Flexors", "Hip Abductors", "Knee Bends", "Tandem Stance", "Sit to Stand", "Stair Walking", "Fell?"];
  var levelAReps = [10, 10, 10, 10, 10, 10];

  var levelBTitles = ["Date", "Knee Extensors", "Knee Flexors", "Hip Abductors"];
  var levelBReps = [];

  var levelCTitles = ["Date", "Knee Extensors", "Knee Flexors", "Hip Abductors"];
  var levelCReps = [];

  var levelDTitles = ["Date", "Knee Extensors", "Knee Flexors", "Hip Abductors"];
  var levelDReps = [];


  var promises = [];
  var levelA = document.getElementById("levelA");
  var levelB = document.getElementById("levelB");
  var levelC = document.getElementById("levelC");
  var levelD = document.getElementById("levelD");
  var user = localStorage.getItem("user");
  var userRef = database.ref(user);

  var row = levelA.insertRow(0);
  var cell = row.insertCell(0);
  displayTopInfo();
  displayTitles(levelATitles, levelA);
  displayTitles(levelBTitles, levelB);
  displayTitles(levelCTitles, levelC);
  displayTitles(levelDTitles, levelD);





 function displayTopInfo(){
  var name = document.getElementById("name");
  var email = document.getElementById("email");
  var tel = document.getElementById("tel");
  var fall = document.getElementById("fall");
  var level = document.getElementById("level");
  name.innerHTML = localStorage.getItem("name");


  userRef.once('value', function(snapshot){
      snapshot.forEach(function(childSnapshot){
        var childKey = childSnapshot.key;
        var childValue = childSnapshot.val();
        console.log(childKey);
        switch(childKey){
          case "email": 
            email.innerHTML = childValue;
          break;
          case "tel":
            childValue = formatPhoneNumber(childValue);
            tel.innerHTML = childValue;
          break;
          case "level":
            level.innerHTML = childValue;
          break;
          case "fall":
            if(childValue===0){
              fall.innerHTML = "None on Record";
            }
            else{
              fall.innerHTML = childValue;
            }
          break;
        }
      });
    });

 }



 function displayTitles(titles, table){
    var titleRow = table.insertRow(0);
    for (var i = 0; i<titles.length; i++){
      var cell = titleRow.insertCell(i);
      cell.innerHTML = titles[i];
    }

  }

  function displayClientNames() {
    firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    var rowIndex = 1;
    var promises = [];

    var table = document.getElementById("Clients");
    database.ref(user.uid+"/clients").once('value', function(snapshot){
      snapshot.forEach(function(childSnapshot){
        var childKey = childSnapshot.key;
        var childValue = childSnapshot.val();
        var row = table.insertRow(rowIndex);
        rowIndex++;
        var cell = row.insertCell(0);
        var emailCell = row.insertCell(1);
        var telCell = row.insertCell(2);
        

        console.log(childKey, childValue);

        promises.push(cell.innerHTML = childKey);
        displayUserInfo(childValue, rowIndex, emailCell, telCell);
        
      });
      return Promise.all(promises);
    });
    }

    });
  }

  function displayUserInfo(uid, row, emailCell, telCell){
    var table = document.getElementById("Clients");
    var row = table.insertRow(row);
    var userRef = database.ref(uid);
    
    userRef.once('value', function(snapshot){
      snapshot.forEach(function(childSnapshot){
        var childKey = childSnapshot.key;
        var childValue = childSnapshot.val();
        switch(childKey){
          case "email": 
            emailCell.innerHTML = childValue;
          break;
          case "tel":
            telCell.innerHTML = childValue;
        }
      });
    });



    

    
  }
</script>


</body>
</html>